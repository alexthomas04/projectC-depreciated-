<link rel="stylesheet" href="css/index.css" type="text/css" />
<div id='chat_area' onload="">
			<div class='text_area'>
				<p>'.' then a command <i>commands</i> for a list of commands</p>
			</div>
			<form onsubmit='handleChat();return false;'  action='#'>
				<input class='chat_input' type='text'><button type='submit'>Send</button>
				<input type="submit" style="position: absolute; left: -9999px"/>
			</form>
		</div>
		<div id='buttons'>
			<div class="command_button">
				<button >move right</button>
				<input type="number">
			</div>
			<div class="command_button">
				<button >move left</button>
				<input type="number">
			</div>
			<div class="command_button">
				<button >move up</button>
				<input type="number">
			</div>
			<div class="command_button">
				<button >move down</button>
				<input type="number">
			</div>
			<div class="command_button">
				<button >look around</button>
				<input type="number">
			</div>
			<div class="command_button">
				<button >pick up</button>
				<input type="number">
			</div>
			<div class="command_button">
				<button >eat</button>
				<input type="number">
			</div>
		</div>
		<div id='command_area' onload="">
			<div class='text_area'>
				
			</div>
			<form onsubmit='handleChat();return false;'  action='#'>
				<input class='chat_input' type='text'><button type='submit'>Send</button>
				<input type="submit" style="position: absolute; left: -9999px"/>
			</form>
		</div>





		<script src="jquery-2.0.3.js"></script>
		<script type="text/javascript">
		setInterval(function(){update();}, 500);
		
		var state=-1;
		var waiting=false;
		function handleChat(){
				var preparedMessage = getChat();
				$(".chat_input").val("");
				if(!(preparedMessage === undefined )){
				$.ajax({
					url: 'chat.php',
					type: 'post',
					dataType: 'json',
					data: {"message": preparedMessage,"state":state}
					
				})
				.done(function(data) {
					console.log('done');
					updateChat(data);
				})
				.fail(function(xhr, textStatus, errorThrown) {
					console.log(errorThrown);
				})
				.always(function() {
					waiting=false;
				});}
				waiting=true;


		}

		function sendMessage(text){
			$.ajax({
					url: 'chat.php',
					type: 'post',
					dataType: 'json',
					data: {"message": text,"state":state}
					
				})
				.done(function(data) {
					console.log('done');
					updateChat(data);
				})
				.fail(function(xhr, textStatus, errorThrown) {
					console.log(errorThrown);
				})
				.always(function() {
					waiting=false;
				});
		}

		function update(){
			if(!waiting){
				waiting=true;
			$.ajax({
					url: 'chat.php',
					type: 'post',
					dataType: 'json',
					data: {"state":state}
					
				})
				.done(function(data) {
					updateChat(data);
				})
				.fail(function(xhr, textStatus, errorThrown) {
					console.log(errorThrown);
				})
				.always(function() {
					console.log("complete");
					waiting=false;
				});
			}
		}

		function getChat(){
			if($('#chat_area .chat_input').val() != "")
				return $('#chat_area .chat_input').val();
			if($('#command_area .chat_input').val() != "")
				return $('#command_area .chat_input').val();
			
		}

		function updateChat(data){
			//logic for chat
			if(data.state>0)
				state = data.state;
			if(data.text){
				var div = $('#chat_area .text_area');
					for (var i = 0; i < data.text.length; i++) {
						$('#chat_area .text_area').append($("<p>"+ data.text[i]+"</p>"));
						div.scrollTop(div.scrollTop()+200);
					}	
				}
				if(data.type == "internal"){
					var div = $('#command_area .text_area');
					$('#command_area .text_area').append("<p>"+data.message+"</p>");
					$('#command_area .text_area').append("<p><span class='time'>"+data.time+"</span> "+data.response+"</p>");
					div.scrollTop(div.scrollTop()+200);
				}
				
			

		}

		function getTabs(){
			$.ajax({
					url: 'projectC.html',
					type: 'post',
					dataType: 'html'
					
				})
				.done(function(data) {
					$('#frame').src(data);
					return data;
				})
				.fail(function(xhr, textStatus, errorThrown) {
					console.log(errorThrown);
				})
				.always(function() {
					console.log("complete");
				});
		}

		$('.command_button button').on('click',function(){
			var command = '/'+$(this).text();
			var number = $(this).siblings('input').val();
			if(number != undefined){
				command += " "+number;
			}
			console.log(command);
			sendMessage(command);
		});
		</script>